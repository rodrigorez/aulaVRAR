<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Teste 3 - Celulares Antigos</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
    <style>
        #fps {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            font-family: Arial;
            font-size: 16px;
            z-index: 1000;
            border-radius: 5px;
        }
        #controls {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            font-family: Arial;
            font-size: 14px;
            z-index: 1000;
            border-radius: 5px;
            width: 250px;
        }
        #velocitySlider {
            width: 100%;
            margin: 10px 0;
        }
        #velocityValue {
            color: #00ff00;
            font-weight: bold;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="fps">FPS: --</div>
    <div id="controls">
        <div>Velocidade do Orb:</div>
        <input type="range" id="velocitySlider" min="0" max="5" step="0.00001" value="0.05000">
        <div>Valor: <span id="velocityValue">0.05000</span></div>
    </div>
    
    <a-scene embedded style="height: 100vh;">
        <a-entity id="skybox"></a-entity>
        
        <!-- Quadro com foto de referência -->
        <a-plane 
            position="0 1.6 -3" 
            rotation="0 0 0" 
            width="2" 
            height="1.5" 
            material="src: https://picsum.photos/800/600; transparent: false; alphaTest: 0.5"
            geometry="primitive: plane">
            
            <!-- Moldura do quadro -->
            <a-box 
                position="0 0 -0.01" 
                width="1.05" 
                height="1.05" 
                depth="0.05" 
                material="color: #8B4513; metalness: 0.3; roughness: 0.7">
            </a-box>
        </a-plane>
    </a-scene>

    <script>
        // Shader para celulares antigos - Orb com velocidade controlável
        const fragmentShader = `
            uniform float time;
            uniform float velocity;
            uniform vec2 resolution;
            varying vec2 vUv;

            void main() {
                vec2 uv = vUv;
                vec2 center = vec2(0.5, 0.5);
                
                float t = time * velocity;
                
                // Fundo básico
                vec3 color = vec3(0.0);
                float noise = sin(uv.x * 4.0 + t) * sin(uv.y * 3.0 + t);
                color += vec3(0.05, 0.02, 0.1) * noise * 0.1;
                
                // Orb principal com movimento complexo e amplitude aumentada
                vec2 orbPos = center + vec2(
                    sin(t) * 0.12 + cos(t * 0.7) * 0.08,
                    cos(t * 0.4) * 0.12 + sin(t * 1.3) * 0.06
                );
                float distToOrb = distance(uv, orbPos);
                
                // Uma camada de brilho apenas
                float orb = smoothstep(0.3, 0.2, distToOrb);
                
                vec3 orbColor = vec3(0.6, 0.2, 0.8) * orb;
                
                color += orbColor;
                
                gl_FragColor = vec4(color, 1.0);
            }
        `;

        const vertexShader = `
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `;

        // Inicializar Three.js
        AFRAME.registerComponent('skybox-shader', {
            init: function() {
                const geometry = new THREE.SphereGeometry(500, 16, 16);
                const skyMaterial = new THREE.ShaderMaterial({
                    vertexShader: vertexShader,
                    fragmentShader: fragmentShader,
                    uniforms: {
                        time: { value: 0 },
                        velocity: { value: 0.05 },
                        resolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) }
                    },
                    side: THREE.BackSide
                });

                const skyMesh = new THREE.Mesh(geometry, skyMaterial);
                this.el.object3D.add(skyMesh);
                this.skyMaterial = skyMaterial;
            },
            
            tick: function(time) {
                if (this.skyMaterial) {
                    this.skyMaterial.uniforms.time.value = performance.now() * 0.001;
                }
            }
        });

        // Adicionar componente ao skybox
        const skyboxEl = document.querySelector('#skybox');
        skyboxEl.setAttribute('skybox-shader', '');

        // Controles de velocidade
        const velocitySlider = document.getElementById('velocitySlider');
        const velocityValue = document.getElementById('velocityValue');
        let skyMaterial = null;

        // Aguardar inicialização do material
        setTimeout(() => {
            skyMaterial = skyboxEl.components['skybox-shader'].skyMaterial;
        }, 100);

        velocitySlider.addEventListener('input', function() {
            const velocity = parseFloat(this.value);
            velocityValue.textContent = velocity.toFixed(5);
            
            if (skyMaterial) {
                skyMaterial.uniforms.velocity.value = velocity;
            }
        });

        // FPS Counter
        let lastTime = performance.now();
        let frameCount = 0;
        let fps = 0;

        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fps').textContent = `FPS: ${fps}`;
                frameCount = 0;
                lastTime = currentTime;
            }
            
            requestAnimationFrame(updateFPS);
        }

        updateFPS();
    </script>
</body>
</html>