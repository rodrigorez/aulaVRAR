<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Galeria {{idGaleria}} - {{nomeGaleria}}</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar-nft.js"></script>
  <style> body { margin: 0; overflow: hidden; } </style>
</head>
<body>
  <a-scene embedded arjs="sourceType: webcam;" cursor="rayOrigin: mouse">
    <!-- Container para os marcadores gerados dinamicamente -->
    <a-entity id="markers-container"></a-entity>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // === PAINEL DE CONTROLE (SUBSTITUÍDO PELO generate.js) ===
    const MARCADORES = [
  {
    "idGaleria": "1",
    "idMarcador": "1",
    "tipoMarcador": "hiro",
    "nomeMarcador": "Mundo J63",
    "modelo3D": "./models/01.glb",
    "escalaModelo": "1.0",
    "animacaoRotacao": "true",
    "velocidadeRotacao": "1.0",
    "corTema": "#87CEEB",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo1_galeria1.html"
  },
  {
    "idGaleria": "1",
    "idMarcador": "2",
    "tipoMarcador": "kanji",
    "nomeMarcador": "Mundo J84",
    "modelo3D": "./models/02.glb",
    "escalaModelo": "0.8",
    "animacaoRotacao": "true",
    "velocidadeRotacao": "0.5",
    "corTema": "#4B0082",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo2_galeria1.html"
  },
  {
    "idGaleria": "1",
    "idMarcador": "3",
    "tipoMarcador": "barcode-5",
    "nomeMarcador": "Mundo J92",
    "modelo3D": "./models/03.glb",
    "escalaModelo": "1.2",
    "animacaoRotacao": "false",
    "velocidadeRotacao": "0",
    "corTema": "#FF6B6B",
    "urlMundo": "https://rodrigorez.github.io/aulaVRAR/import/mundos/mundo3_galeria1.html"
  }
];
    // === FIM DO PAINEL DE CONTROLE ===

    document.addEventListener('DOMContentLoaded', () => {
      const container = document.querySelector('#markers-container');

      if (typeof MARCADORES === 'undefined' || !Array.isArray(MARCADORES)) {
          console.error("❌ Erro: Array MARCADORES não encontrado ou inválido no template.");
          return;
      }

      MARCADORES.forEach(m => {
        const markerEl = document.createElement('a-marker');
        // Define o tipo de marcador
        if (['hiro', 'kanji'].includes(m.tipoMarcador)) {
            markerEl.setAttribute('preset', m.tipoMarcador);
        } else if (m.tipoMarcador.startsWith('barcode-')) {
            const value = m.tipoMarcador.split('-')[1];
            markerEl.setAttribute('type', 'barcode');
            markerEl.setAttribute('value', value);
        } else {
            // Para marcadores customizados, você pode precisar de 'url'
            // markerEl.setAttribute('url', m.tipoMarcador); // Ex: 'path/to/pattern-marker.patt'
            console.warn(`⚠️ Tipo de marcador desconhecido: ${m.tipoMarcador}`);
        }

        const entityEl = document.createElement('a-entity');
        entityEl.setAttribute('gltf-model', m.modelo3D);
        entityEl.setAttribute('scale', `${m.escalaModelo} ${m.escalaModelo} ${m.escalaModelo}`);

        if (m.animacaoRotacao === 'true') {
          const duracao = 5000 / (parseFloat(m.velocidadeRotacao) || 1.0);
          entityEl.setAttribute('animation', `property: rotation; to: 0 360 0; loop: true; dur: ${duracao}; easing: linear`);
        }

        // Adiciona clique para ir para o mundo
        entityEl.addEventListener('click', () => {
          window.location.href = m.urlMundo;
        });

        markerEl.appendChild(entityEl);
        container.appendChild(markerEl);
      });
    });
  </script>
</body>
</html>